---
title: effect 成倍的触发
date: 2025-09-25
tags:
  - vue
---


响应式经过努力, 已经初具雏形了, 现在加入 dom 交互, 来测试一下

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>

<button id="btn">按钮</button>
<script type="module">
  // import { ref, effect } from '../../../node_modules/vue/dist/vue.esm-browser.prod.js'
  import {ref, effect} from '../dist/reactivity.esm.js'

  const flag = ref(true)

  effect(() => {
    flag.value
    console.count('effect')
  })

  btn.onclick = () => {
    flag.value = !flag.value

  }
</script>
</body>
</html>
```

点击按钮, 发现 effect 成倍的触发, 这是为什么呢?

![](https://raw.githubusercontent.com/patty-yang/pic/img/test/effect.gif)
原因是我们在 trigger 里, 直接 forEach 了 effects, 然后在 effect 里, 又执行了 trigger, 导致死循环
