## 通过 defer 方案，完成首屏切片化渲染

首页打开的速度特别慢,无论是我们的自测,还是根据埋点反馈的数据也好,基本可以排除网络因素,主要原因还是首评渲染的 DOM
比较多。这个我们页清楚,所以一开始给用户做了**骨架屏和延迟分屏渲染的相关优化**

但是这两个不能解决关键问题,骨架屏本身就是治标不治本的方法,而分屏渲染只是解决了不在当前视口的 DOM
内容优化渲染的问题，而我们的项目麻烦点在于,首屏内容本身的 DOM 阶段渲染就非常的多。分屏分页只能解决不在当前视口内容渲染的问题

最后采用了 `requestAnimationFrame` API进行分帧渲染,根本原理就是利用 RAF
下一次重绘之前执行回掉函数，将长任务分帧，分解成一个一个的短任务,当然还需要封装对应的脚本工具，探测页面的节点,根据节点渲染的优先级进行处理

这样的处理对原有的代码侵入性最少,而且以比较简单直接的方式，解决了首评渲染时间过长的问题,经过这样的优化，首屏的
FCP、LCP时间大幅降低。

## RAF 分帧

它的核心是在 **下次重绘之前执行回掉函数**。

可以**利用vue响应式数据的更新机制,在每一帧更新响应式的值**，比如一个不重复自增的值,而在 vue 中，任何依赖于这个 *
*响应式数据的组件或者计算属性都会在数据改变时自动更新**,由于数据的更新是逐帧进行的,这样就实现了分帧渲染的效果

对于界面上使用的话，可以使用脚本或者插件的方式,遍历页面节点，根据页面 css 相关命名规范,确定页面渲染的优先级,动态的给响应节点加入
defer 函数，确保对应的节点可以一次进行渲染

## 性能指标相关内容

![Web.dev](https://web.dev/articles/lcp?hl=zh-cn)