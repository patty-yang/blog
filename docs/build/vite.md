# vite çš„é…ç½®

## âš™ï¸ åŸºç¡€é…ç½®

#### root

- ğŸ“ æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ï¼ˆindex.html æ‰€åœ¨çš„ä½ç½®ï¼‰

#### define

- ğŸ”§ å®šä¹‰å…¨å±€å¸¸é‡æ›¿æ¢
  > ğŸ’¡ Vite ä½¿ç”¨ esbuild çš„ define ç‰¹æ€§è¿›è¡Œå¸¸é‡æ›¿æ¢ã€‚è¡¨è¾¾å¼å¿…é¡»æ˜¯ JSON å¯åºåˆ—åŒ–çš„å€¼ï¼ˆåŒ…æ‹¬
  nullã€booleanã€numberã€stringã€arrayã€objectï¼‰æˆ–å•ä¸ªæ ‡è¯†ç¬¦ã€‚å¯¹äºéå­—ç¬¦ä¸²å€¼ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†å…¶è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²æ ¼å¼ã€‚

#### resolve

- **alias**: ğŸ“ é…ç½®è·¯å¾„åˆ«åï¼Œç®€åŒ–å¯¼å…¥è·¯å¾„
- **extensions**: ğŸ“„ é…ç½®æ–‡ä»¶æ‰©å±•åè‡ªåŠ¨è§£æ

#### CSS ç›¸å…³é…ç½®

- **devSourcemap**: ğŸ—ºï¸ å¼€å‘ç¯å¢ƒçš„ CSS source map
- **postcss**: ğŸ¨ PostCSS é…ç½®é€‰é¡¹
- **preprocessorOptions**: ğŸ”„ é¢„å¤„ç†å™¨é…ç½®ï¼ˆå¦‚ SCSS ç­‰ï¼‰

```js
export default defineConfig({
  css: {
    // postcss: 'config'
    postcss: {
      plugins: [autoprefixer(), cssnano()]
    }
  }
})
```

## ğŸ–¥ï¸ æœåŠ¡å™¨é…ç½®

#### ğŸŒ host

- æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ IP åœ°å€
  > ğŸ’¡ è®¾ç½®ä¸º `0.0.0.0` æˆ– `true` å¯ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œä¾¿äºå¤šè®¾å¤‡æµ‹è¯•

#### ğŸ”¢ port

- æŒ‡å®šå¼€å‘æœåŠ¡å™¨ç«¯å£å·
  > é»˜è®¤ä¸º 5173

#### ğŸ”’ strictPort

- ç«¯å£ä¸¥æ ¼æ¨¡å¼
  > å½“æŒ‡å®šç«¯å£è¢«å ç”¨æ—¶ï¼Œæ˜¯å¦ç›´æ¥é€€å‡ºè€Œä¸æ˜¯å°è¯•ä¸‹ä¸€ä¸ªå¯ç”¨ç«¯å£

#### ğŸ”„ proxy

- é…ç½®å¼€å‘æœåŠ¡å™¨ä»£ç†
  > ç”¨äºè§£å†³å¼€å‘ç¯å¢ƒçš„è·¨åŸŸé—®é¢˜

#### ğŸ‘€ watch

- è‡ªå®šä¹‰æ–‡ä»¶ç›‘è§†å™¨é…ç½®
  > åº•å±‚ä½¿ç”¨ `chokidar`ï¼ˆå¼ºå¤§çš„ Node.js æ–‡ä»¶ç³»ç»Ÿç›‘å¬åº“ï¼‰
  > æ”¯æŒå¿½ç•¥ç‰¹å®šæ–‡ä»¶/æ–‡ä»¶å¤¹çš„å˜åŒ–

```js
export default defineConfig({
  server: {
    watch: {
      // ä»»ä½•æ¨¡å—ä¸‹çš„file.txtæ›´æ”¹éƒ½ä¼šè§¦å‘ HMR
      ignored: ['**/file.txt']
    }
  }
})
```

#### ğŸ” https

- SSL é…ç½®é€‰é¡¹
  > æ”¯æŒé…ç½® SSL è¯ä¹¦å’Œç§é’¥è·¯å¾„
  > ç”¨äºå¼€å‘ç¯å¢ƒä¸‹çš„ HTTPS æœåŠ¡

```js
export default defineConfig({
  server: {
    https: {
      key: fs.readFileSync(''),
      cert: fs.readFileSync('')
    }
  }
})
```

## ğŸ”„ ä¾èµ–é¢„æ„å»º

åœ¨**é¦–æ¬¡**ä½¿ç”¨ Vite å¯åŠ¨é¡¹ç›®æ—¶ï¼Œä¼šå¯¹é¡¹ç›®ä¾èµ–è¿›è¡Œé¢„æ„å»º

### ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦é¢„æ„å»ºï¼Ÿ

å­˜åœ¨çš„ä¸»è¦é—®é¢˜ï¼š

1. ğŸ“¦ **è¯·æ±‚è´Ÿæ‹…**ï¼šå¤§é‡ä¾èµ–æ–‡ä»¶ä¼šå¯¼è‡´æµè§ˆå™¨å‘èµ·è¿‡å¤š HTTP è¯·æ±‚
2. ğŸ”„ **å…¼å®¹æ€§é—®é¢˜**ï¼šéƒ¨åˆ†ä¾èµ–åŒ…ä½¿ç”¨ CommonJS æ ¼å¼å‘å¸ƒï¼Œä¸ ESM ç¯å¢ƒä¸å…¼å®¹

### âš¡ Vite çš„è§£å†³æ–¹æ¡ˆ

ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼ŒVite åœ¨é¦–æ¬¡å¯åŠ¨æ—¶ä¼šæ‰§è¡Œä¾èµ–é¢„æ„å»ºã€‚è¿™ä¸ªè¿‡ç¨‹ç”± `esbuild` å¤„ç†ï¼Œæ”¯æŒå¹¶è¡Œå¤„ç†ä»¥æå‡æ•ˆç‡ã€‚

### ğŸ› ï¸ esbuild çš„æ ¸å¿ƒå·¥ä½œ

1. ğŸ“¥ **æ¨¡å—è½¬æ¢**

    - å°† CommonJS/UMD æ ¼å¼æ¨¡å—è½¬æ¢ä¸º ESM æ ¼å¼
    - ç¡®ä¿æ‰€æœ‰æ¨¡å—éƒ½ç¬¦åˆ ESM è§„èŒƒ

2. ğŸ“¦ **ä¾èµ–æ‰“åŒ…**

    - åˆå¹¶ä¾èµ–æ–‡ä»¶
    - å‡å°‘å¼€å‘ç¯å¢ƒä¸­çš„æµè§ˆå™¨è¯·æ±‚æ•°é‡

3. ğŸ—œï¸ **ä»£ç ä¼˜åŒ–**

    - æ‰§è¡Œä»£ç æœ€å°åŒ–å¤„ç†
    - å®ç°é«˜æ•ˆçš„ä»£ç å‹ç¼©

4. âš¡ **å¢é‡ç¼–è¯‘**
    - æ™ºèƒ½æ£€æµ‹å˜æ›´
    - ä»…ç¼–è¯‘æ–°å¢æˆ–ä¿®æ”¹çš„éƒ¨åˆ†
    - æé«˜æ„å»ºæ•ˆç‡

### ğŸ’¾ ç¼“å­˜æœºåˆ¶

esbuild å°†æ„å»ºäº§ç‰©ç¼“å­˜è‡³ `node_modules/.vite` ç›®å½•ï¼š

1. ğŸ“ **æ–‡ä»¶ç³»ç»Ÿç¼“å­˜**

2. ğŸŒ **æµè§ˆå™¨ç¼“å­˜**

#### ğŸ”„ è§¦å‘é‡æ–°é¢„æ„å»ºçš„æ¡ä»¶

ä»¥ä¸‹ä»»ä¸€æƒ…å†µå‘ç”Ÿå˜åŒ–éƒ½å°†è§¦å‘é‡æ–°é¢„æ„å»ºï¼š

1. ğŸ“¦ åŒ…ç®¡ç†å™¨çš„é”æ–‡ä»¶å†…å®¹å˜æ›´

    - package-lock.json
    - pnpm-lock.yaml
    - yarn.lock

2. âš™ï¸ vite.config.js ç›¸å…³é…ç½®æ”¹åŠ¨

3. ğŸ”§ NODE_ENV ç¯å¢ƒå˜é‡ä¿®æ”¹

> ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–**ï¼š
> é¢„æ„å»ºçš„ä¾èµ–åœ¨æµè§ˆå™¨ç«¯ä¼šå¯ç”¨å¼ºç¼“å­˜æœºåˆ¶ï¼ˆHTTP header: max-age=31536000ï¼‰ï¼Œ
> æ˜¾è‘—æå‡å¼€å‘ç¯å¢ƒä¸‹çš„åŠ è½½æ€§èƒ½ã€‚

## ğŸ› ï¸ è‡ªå®šä¹‰é¢„æ„å»ºé…ç½®

#### ğŸ“ entries å…¥å£é…ç½®

Vite æä¾›äº†çµæ´»çš„å…¥å£ç‚¹é…ç½®æœºåˆ¶ï¼š

- ğŸ” **é»˜è®¤è¡Œä¸º**ï¼š

    - Vite è‡ªåŠ¨æ‰«æ `index.html` ä»¥æ£€æµ‹é¢„æ„å»ºä¾èµ–
    - ä¼šæ™ºèƒ½è·³è¿‡ `node_modules` å’Œ `build.outDir` ç›®å½•

- ğŸ¯ **è‡ªå®šä¹‰å…¥å£**ï¼š
    - å½“é…ç½®äº† `build.rollupOptions.input` æ—¶ï¼ŒVite å°†ä½¿ç”¨è¿™äº›å…¥å£ç‚¹
    - å¦‚éœ€æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ç›´æ¥é€šè¿‡ `entries` æŒ‡å®šä¾èµ–å…¥å£

æ”¯æŒä»¥ä¸‹é…ç½®æ–¹å¼ï¼š

1. ğŸ“ **åŸºç¡€é…ç½®**ï¼šç›´æ¥æŒ‡å®šå…·ä½“æ–‡ä»¶è·¯å¾„

```js
export default defineConfig({
  optimizeDeps: {
    entries: ['src/main.js', 'src/main.js'] // æŒ‡å®šå…¥å£æ–‡ä»¶
  }
})
```

1. ğŸŒŸ **Glob æ¨¡å¼**ï¼šä½¿ç”¨é€šé…ç¬¦åŒ¹é…å¤šä¸ªæ–‡ä»¶

```js
export default defineConfig({
  optimizeDeps: {
    entries: ['src/**/*.js'] // åŒ¹é… src ç›®å½•ä¸‹çš„æ‰€æœ‰ .js æ–‡ä»¶
  }
})
```

1. âŒ **æ’é™¤è§„åˆ™**ï¼šé€šè¿‡ç‰¹å®šè¯­æ³•æ’é™¤ä¸éœ€è¦çš„ç›®å½•

```js
export default defineConfig({
  optimizeDeps: {
    entries: [
      'src/**/*.js',
      '!src/ignore/**/*.js' // æ’é™¤ src/ignore ç›®å½•ä¸‹çš„æ‰€æœ‰.js æ–‡ä»¶
    ]
  }
})
```

1. é…ç½® node_modules çš„ includes excludes

## ğŸ—ï¸ Vite ç”Ÿäº§ç‰ˆæœ¬æ„å»º

### ğŸ“¦ æ ¸å¿ƒç‰¹æ€§

1. **ä»£ç åˆ†å‰²å’ŒåŠ¨æ€å¯¼å…¥**

2. **ğŸŒ³ Tree Shaking**

3. **ğŸ”Œ æ’ä»¶ç”Ÿæ€**

4. **âš™ï¸ åŠ¨æ€æ§åˆ¶å’Œä¼˜åŒ–**

5. **âœ¨ ç”Ÿäº§ä¼˜åŒ–**

```js
export default defineConfig({
  build: {
    target: 'modules',
    outDir: 'dist', // æ‰“åŒ…åçš„ç›®å½•
    assetsDir: 'assets', // é™æ€èµ„æºçš„ç›®å½•
    cssMinify: 'esbuild', // å‹ç¼©css
    minify: 'terser', // å‹ç¼©js
    sourcemap: 'inline' // ç”Ÿæˆsourcemapæ–‡ä»¶
  }
})
```
